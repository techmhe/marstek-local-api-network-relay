services:
  homeassistant:
    image: ghcr.io/home-assistant/home-assistant:stable
    container_name: marstek-ha-dev
    privileged: true
    environment:
      - GIT_EDITOR=code --wait
      - WORKSPACE_DIRECTORY=/workspaces/ha_marstek
    volumes:
      - ..:/workspaces/ha_marstek:cached
      - ../custom_components:/config/custom_components:cached
    ports:
      - "8123:8123"
    networks:
      marstek_net:
        ipv4_address: 172.28.0.10
    command: python -m homeassistant -c /config

  mock-marstek:
    build:
      context: ../tools/mock_device
      dockerfile: Dockerfile
    container_name: marstek-mock-device
    environment:
      - MOCK_IP=172.28.0.20
    networks:
      marstek_net:
        ipv4_address: 172.28.0.20
    # Override command to use the container's IP
    command: ["python", "mock_marstek.py", "--ip", "172.28.0.20"]

  mock-marstek-2:
    build:
      context: ../tools/mock_device
      dockerfile: Dockerfile
    container_name: marstek-mock-device-2
    environment:
      - MOCK_IP=172.28.0.21
    networks:
      marstek_net:
        ipv4_address: 172.28.0.21
    command: ["python", "mock_marstek.py", "--ip", "172.28.0.21", "--ble-mac", "009b08a5bb40", "--wifi-mac", "7483c2315cf9", "--soc", "75"]

  mock-marstek-3:
    build:
      context: ../tools/mock_device
      dockerfile: Dockerfile
    container_name: marstek-mock-device-3
    environment:
      - MOCK_IP=172.28.0.22
    networks:
      marstek_net:
        ipv4_address: 172.28.0.22
    command: ["python", "mock_marstek.py", "--ip", "172.28.0.22", "--ble-mac", "009b08a5cc41", "--wifi-mac", "7483c2315cfa", "--soc", "30"]

networks:
  marstek_net:
    driver: bridge
    ipam:
      config:
        - subnet: 172.28.0.0/16
