services:
  homeassistant:
    image: ghcr.io/home-assistant/home-assistant:stable
    container_name: marstek-ha-dev
    privileged: true
    environment:
      - GIT_EDITOR=code --wait
      - WORKSPACE_DIRECTORY=/workspaces/ha_marstek
    volumes:
      - ..:/workspaces/ha_marstek:cached
      - ha_config:/config
      - ../custom_components:/config/custom_components:cached
    ports:
      - "8123:8123"
    networks:
      marstek_net:
        ipv4_address: 172.28.0.10
    command: python -m homeassistant -c /config

  # Mock device 1 - uses defaults from const.py (02deadbeef01, 02cafebabe01)
  mock-marstek:
    build:
      context: ../tools/mock_device
      dockerfile: Dockerfile
    container_name: marstek-mock-device
    environment:
      - MOCK_IP=172.28.0.20
    networks:
      marstek_net:
        ipv4_address: 172.28.0.20
    command: ["python", "-m", "mock_device", "--ip", "172.28.0.20", "--soc", "50"]

  # Mock device 2 - unique mock MACs
  mock-marstek-2:
    build:
      context: ../tools/mock_device
      dockerfile: Dockerfile
    container_name: marstek-mock-device-2
    environment:
      - MOCK_IP=172.28.0.21
    networks:
      marstek_net:
        ipv4_address: 172.28.0.21
    command: ["python", "-m", "mock_device", "--ip", "172.28.0.21", "--ble-mac", "02deadbeef02", "--wifi-mac", "02cafebabe02", "--soc", "75"]

  # Mock device 3 - unique mock MACs
  mock-marstek-3:
    build:
      context: ../tools/mock_device
      dockerfile: Dockerfile
    container_name: marstek-mock-device-3
    environment:
      - MOCK_IP=172.28.0.22
    networks:
      marstek_net:
        ipv4_address: 172.28.0.22
    command: ["python", "-m", "mock_device", "--ip", "172.28.0.22", "--ble-mac", "02deadbeef03", "--wifi-mac", "02cafebabe03", "--soc", "30"]

  # Mock device 4 - Venus D with PV (4 MPPT channels)
  mock-marstek-4:
    build:
      context: ../tools/mock_device
      dockerfile: Dockerfile
    container_name: marstek-mock-device-4
    environment:
      - MOCK_IP=172.28.0.23
    networks:
      marstek_net:
        ipv4_address: 172.28.0.23
    command: ["python", "-m", "mock_device", "--ip", "172.28.0.23", "--device", "VenusD", "--ble-mac", "02deadbeef04", "--wifi-mac", "02cafebabe04", "--soc", "60", "--pv-channels", "320:42:7.6,280:40:7.0,240:38:6.3,180:36:5.0"]

networks:
  marstek_net:
    driver: bridge
    ipam:
      config:
        - subnet: 172.28.0.0/16

volumes:
  ha_config:
    name: marstek-ha-config
